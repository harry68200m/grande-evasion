<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button></ion-back-button>
    </ion-buttons>
    <ion-title *ngIf="roomData">{{roomData.name}}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content padding>
  <ion-spinner class="loader" *ngIf="!isLoaded" name="crescent"></ion-spinner>
  <div *ngIf="isLoaded">
    <div class="backdrop" *ngIf="roomData">
      <img [src]="roomData.url_img" />
    </div>
    <div class="backdrop-separator1"></div>
    <div class="backdrop-separator2"></div>

    <div class="poster" *ngIf="roomData">
      <img class="poster" [src]="roomData.url_img" />
      <img class="poster-effect" [src]="roomData.url_img" />
    </div>

    <div class="room-data">
      <div class="name" *ngIf="roomData">{{roomData.name}}</div>
      <div class="date" *ngIf="roomData">
        {{date | date: 'dd/MM/YYYY':'GMT+1'}}
      </div>
      <div style="text-align: center">
        <ion-chip *ngIf="!notifActivated" class="alertStatus" color="danger">
          <ion-label style="font-size: small"> Alertes désactivées </ion-label>
        </ion-chip>
        <ion-chip *ngIf="notifActivated" class="alertStatus" color="success">
          <ion-label style="font-size: small"> Alertes activées </ion-label>
        </ion-chip>
      </div>

      <hr />
      <ion-button
        *ngIf="!notifActivated"
        (click)="enableNotif()"
        style="margin: 6%"
        expand="block"
        color="warning"
        >Activer les alertes</ion-button
      >
      <ion-button
        *ngIf="notifActivated"
        (click)="presentAlertConfirmUnregister()"
        style="margin: 6%"
        expand="block"
        color="primary"
        >Désactiver les alertes</ion-button
      >
    </div>
  </div>
  <div class="rate" style="margin: 6%">
    <div *ngIf="isLoaded">
      <div class="date">Derniers relevés :</div>
      <div style="text-align: center" *ngIf="roomData">
        <ion-chip
          color="success"
          style="font-size: small"
          class="chipRate"
          *ngIf="getLastValue('CO2')"
        >
          <ion-icon name="speedometer-outline"></ion-icon>
          <ion-label style="font-size: small">
            {{getLastValue('CO2')}} ppm à {{getLastValue('date') | date: 'H:mm':'GMT+1'}}
          </ion-label>
        </ion-chip>
        <ion-chip
          color="primary"
          style="font-size: small"
          class="chipPeopleCount"
          *ngIf="getLastValue('webcam')"
        >
          <ion-icon name="person-outline"></ion-icon>
          <ion-label style="font-size: small">
            {{getLastValue('webcam')}} personnes
          </ion-label>
        </ion-chip>
        <ion-chip  *ngIf="roomData && roomData.prediction >0" class="alertStatus" color="secondary">
          <ion-label style="font-size: small"> Prochaine aération dans : {{roomData.prediction}} minutes </ion-label>
        </ion-chip>
        <ion-chip  *ngIf="roomData && roomData.prediction < 0" class="alertStatus" color="danger">
          <ion-label style="font-size: small"> Seuil dépassé : Aérez la salle </ion-label>
        </ion-chip>
      </div>
    </div>
    <br />
    <div>
      <canvas #myCanvas width="600" height="700"></canvas>
    </div>
    <ion-button expand="block" color="primary" (click)="presentModal()"
      >Historique des mesures</ion-button
    >
  </div>
  <hr />
  <div *ngIf="isLoaded" class="devices">
    <div class="date">Matériel de la salle :</div>
    <ion-grid style="text-align: center" *ngIf="roomData">
      <ion-row>
        <ion-col>
          <div>Capteurs</div>
          <div *ngFor="let sensor of roomData.sensors; let i = index">
            <ion-chip color="secondary" *ngIf=" sensor.type == 'CO2'">
              <ion-icon name="videocam"></ion-icon>
              <ion-label style="font-size: small">{{sensor.name}}</ion-label>
            </ion-chip>
          </div>
        </ion-col>
        <ion-col>
          <div>Caméras</div>
          <div *ngFor="let sensor of roomData.sensors; let i = index">
            <ion-chip color="secondary" *ngIf=" sensor.type == 'Webcam'">
              <ion-icon name="videocam"></ion-icon>
              <ion-label style="font-size: small">{{sensor.name}}</ion-label>
            </ion-chip>
          </div>
        </ion-col>
      </ion-row>
    </ion-grid>
  </div>
</ion-content>
